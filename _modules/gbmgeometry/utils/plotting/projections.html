<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gbmgeometry.utils.plotting.projections &mdash; gbmgeometry  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.0-rc.0/dist/embed-amd.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <link rel="stylesheet" href="../../../../_static/pygments/default.css" type="text/css" id="pygments-style">
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css">
   

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> gbmgeometry
            <img src="../../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/demo.html">GBM Geometry Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/demo.html#Fermi-plotting-and-computing-blockage">Fermi plotting and computing blockage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/posinterp.html">The PositionInterpolator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/pointsource.html">Plotting Points on the Sky</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/modules.html">twopc</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">gbmgeometry</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!--
  <div class="admonition note">
    <p><a href="https://github.com/lukelbd">ProPlot author here</a>: Due to my day job as a graduate student, certain <a href="https://github.com/lukelbd/proplot/pulls?q=is%3Aopen+is%3Apr">feature additions</a> may be delayed to the summer of 2020. In the meantime, if you are interested in contributing to ProPlot, please see the <a href="https://proplot.readthedocs.io/en/latest/contributions.html">contribution guide</a>. Any amount of help is welcome!
    </p>
  </div>
  -->
  <li id="lightdark-li">
    <label for="lightdark-checkbox" id="lightdark-label">
      <input type="checkbox" id="lightdark-checkbox"/>
      <div class="btn-neutral"></div>
    </label>
  </li>
  
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
      <li>gbmgeometry.utils.plotting.projections</li>

      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script type="text/javascript" src=../../../../_static/custom.js></script>
  
           <div itemprop="articleBody">
             
  <h1>Source code for gbmgeometry.utils.plotting.projections</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright (C) 2012-2020  Leo Singer</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>


<span class="c1"># I grabbed this from leo singer as it is a nicely written tool</span>
<span class="c1"># but I do not want the user to have to install gsl and the</span>
<span class="c1"># the whole ligo framework</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Axes subclasses for astronomical mapmaking.</span>

<span class="sd">This module adds several :class:`astropy.visualization.wcsaxes.WCSAxes`</span>
<span class="sd">subclasses to the Matplotlib projection registry. The projections have names of</span>
<span class="sd">the form :samp:`{astro_or_geo} [{lon_units}] {projection}`.</span>

<span class="sd">:samp:`{astro_or_geo}` may be ``astro`` or ``geo``. It controls the</span>
<span class="sd">reference frame, either celestial (ICRS) or terrestrial (ITRS).</span>

<span class="sd">:samp:`{lon_units}` may be ``hours`` or ``degrees``. It controls the units of</span>
<span class="sd">the longitude axis. If omitted, ``astro`` implies ``hours`` and ``geo`` implies</span>
<span class="sd">degrees.</span>

<span class="sd">:samp:`{projection}` may be any of the following:</span>

<span class="sd">* ``aitoff`` for the Aitoff all-sky projection</span>

<span class="sd">* ``mollweide`` for the Mollweide all-sky projection</span>

<span class="sd">* ``globe`` for an orthographic projection, like the three-dimensional view of</span>
<span class="sd">  the Earth from a distant satellite</span>

<span class="sd">* ``zoom`` for a gnomonic projection suitable for visualizing small zoomed-in</span>
<span class="sd">  patches</span>

<span class="sd">Some of the projections support additional optional arguments. The ``globe``</span>
<span class="sd">projections support the options ``center`` and ``rotate``. The ``zoom``</span>
<span class="sd">projections support the options ``center``, ``radius``, and ``rotate``.</span>

<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">.. plot::</span>
<span class="sd">   :context: reset</span>
<span class="sd">   :include-source:</span>
<span class="sd">   :align: center</span>

<span class="sd">    import ligo.skymap.plot</span>
<span class="sd">    from matplotlib import pyplot as plt</span>
<span class="sd">    ax = plt.axes(projection=&#39;astro hours mollweide&#39;)</span>
<span class="sd">    ax.grid()</span>

<span class="sd">.. plot::</span>
<span class="sd">   :context: reset</span>
<span class="sd">   :include-source:</span>
<span class="sd">   :align: center</span>

<span class="sd">    import ligo.skymap.plot</span>
<span class="sd">    from matplotlib import pyplot as plt</span>
<span class="sd">    ax = plt.axes(projection=&#39;geo aitoff&#39;)</span>
<span class="sd">    ax.grid()</span>

<span class="sd">.. plot::</span>
<span class="sd">   :context: reset</span>
<span class="sd">   :include-source:</span>
<span class="sd">   :align: center</span>

<span class="sd">    import ligo.skymap.plot</span>
<span class="sd">    from matplotlib import pyplot as plt</span>
<span class="sd">    ax = plt.axes(projection=&#39;astro zoom&#39;,</span>
<span class="sd">                  center=&#39;5h -32d&#39;, radius=&#39;5 deg&#39;, rotate=&#39;20 deg&#39;)</span>
<span class="sd">    ax.grid()</span>

<span class="sd">.. plot::</span>
<span class="sd">   :context: reset</span>
<span class="sd">   :include-source:</span>
<span class="sd">   :align: center</span>

<span class="sd">    import ligo.skymap.plot</span>
<span class="sd">    from matplotlib import pyplot as plt</span>
<span class="sd">    ax = plt.axes(projection=&#39;geo globe&#39;, center=&#39;-50d +23d&#39;)</span>
<span class="sd">    ax.grid()</span>

<span class="sd">Complete Example</span>
<span class="sd">----------------</span>
<span class="sd">The following example demonstrates most of the features of this module.</span>

<span class="sd">.. plot::</span>
<span class="sd">   :context: reset</span>
<span class="sd">   :include-source:</span>
<span class="sd">   :align: center</span>

<span class="sd">    from astropy.coordinates import SkyCoord</span>
<span class="sd">    from astropy.io import fits</span>
<span class="sd">    from astropy import units as u</span>
<span class="sd">    import ligo.skymap.plot</span>
<span class="sd">    from matplotlib import pyplot as plt</span>

<span class="sd">    url = &#39;https://dcc.ligo.org/public/0146/G1701985/001/bayestar_no_virgo.fits.gz&#39;</span>
<span class="sd">    center = SkyCoord.from_name(&#39;NGC 4993&#39;)</span>

<span class="sd">    fig = plt.figure(figsize=(4, 4), dpi=100)</span>

<span class="sd">    ax = plt.axes(</span>
<span class="sd">        [0.05, 0.05, 0.9, 0.9],</span>
<span class="sd">        projection=&#39;astro globe&#39;,</span>
<span class="sd">        center=center)</span>

<span class="sd">    ax_inset = plt.axes(</span>
<span class="sd">        [0.59, 0.3, 0.4, 0.4],</span>
<span class="sd">        projection=&#39;astro zoom&#39;,</span>
<span class="sd">        center=center,</span>
<span class="sd">        radius=10*u.deg)</span>

<span class="sd">    for key in [&#39;ra&#39;, &#39;dec&#39;]:</span>
<span class="sd">        ax_inset.coords[key].set_ticklabel_visible(False)</span>
<span class="sd">        ax_inset.coords[key].set_ticks_visible(False)</span>
<span class="sd">    ax.grid()</span>
<span class="sd">    ax.mark_inset_axes(ax_inset)</span>
<span class="sd">    ax.connect_inset_axes(ax_inset, &#39;upper left&#39;)</span>
<span class="sd">    ax.connect_inset_axes(ax_inset, &#39;lower left&#39;)</span>
<span class="sd">    ax_inset.scalebar((0.1, 0.1), 5 * u.deg).label()</span>
<span class="sd">    ax_inset.compass(0.9, 0.1, 0.2)</span>

<span class="sd">    ax.imshow_hpx(url, cmap=&#39;cylon&#39;)</span>
<span class="sd">    ax_inset.imshow_hpx(url, cmap=&#39;cylon&#39;)</span>
<span class="sd">    ax_inset.plot(</span>
<span class="sd">        center.ra.deg, center.dec.deg,</span>
<span class="sd">        transform=ax_inset.get_transform(&#39;world&#39;),</span>
<span class="sd">        marker=ligo.skymap.plot.reticle(),</span>
<span class="sd">        markersize=30,</span>
<span class="sd">        markeredgewidth=3)</span>

<span class="sd">&quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="kn">import</span> <span class="n">convolve_fft</span><span class="p">,</span> <span class="n">Gaussian2DKernel</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.io.fits</span> <span class="kn">import</span> <span class="n">Header</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span> <span class="nn">astropy.visualization.wcsaxes</span> <span class="kn">import</span> <span class="n">WCSAxes</span>
<span class="kn">from</span> <span class="nn">astropy.visualization.wcsaxes.formatter_locator</span> <span class="kn">import</span> <span class="n">AngleFormatterLocator</span>
<span class="kn">from</span> <span class="nn">astropy.visualization.wcsaxes.frame</span> <span class="kn">import</span> <span class="n">EllipticalFrame</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">matplotlib.offsetbox</span> <span class="kn">import</span> <span class="n">AnchoredOffsetbox</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">ConnectionPatch</span><span class="p">,</span> <span class="n">FancyArrowPatch</span><span class="p">,</span> <span class="n">PathPatch</span>
<span class="kn">from</span> <span class="nn">matplotlib.projections</span> <span class="kn">import</span> <span class="n">projection_registry</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># from reproject import reproject_from_healpix</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize_scalar</span>
<span class="kn">from</span> <span class="nn">.angle</span> <span class="kn">import</span> <span class="n">reference_angle_deg</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">itrs_frame_monkeypatch</span>

<span class="n">itrs_frame_monkeypatch</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AutoScaledWCSAxes&quot;</span><span class="p">,</span> <span class="s2">&quot;ScaleBar&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">WCSInsetPatch</span><span class="p">(</span><span class="n">PathPatch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Subclass of `matplotlib.patches.PathPatch` for marking the outline of</span>
<span class="sd">    one `astropy.visualization.wcsaxes.WCSAxes` inside another.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">get_linewidth</span><span class="p">(),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">frame</span>
        <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">WCSInsetConnectionPatch</span><span class="p">(</span><span class="n">ConnectionPatch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Patch to connect an inset WCS axes inside another WCS axes.&quot;&quot;&quot;</span>

    <span class="n">_corners_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ax_inset</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">AnchoredOffsetbox</span><span class="o">.</span><span class="n">codes</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">ax_inset</span><span class="o">.</span><span class="n">viewLim</span><span class="o">.</span><span class="n">corners</span><span class="p">()</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ax_inset</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">transform</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">xy_inset</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_corners_map</span><span class="p">[</span><span class="n">loc</span><span class="p">]]</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">xy_inset</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">xy</span><span class="p">,</span>
            <span class="n">xy_inset</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">ax_inset</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">ax_inset</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">ax_inset</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">get_linewidth</span><span class="p">(),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>


<div class="viewcode-block" id="AutoScaledWCSAxes"><a class="viewcode-back" href="../../../../notebooks/api/gbmgeometry.utils.plotting.html#gbmgeometry.utils.plotting.projections.AutoScaledWCSAxes">[docs]</a><span class="k">class</span> <span class="nc">AutoScaledWCSAxes</span><span class="p">(</span><span class="n">WCSAxes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Axes base class. The pixel scale is adjusted to the DPI of the image,</span>
<span class="sd">    and there are a variety of convenience methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;astro wcs&quot;</span>

<div class="viewcode-block" id="AutoScaledWCSAxes.__init__"><a class="viewcode-back" href="../../../../notebooks/api/gbmgeometry.utils.plotting.html#gbmgeometry.utils.plotting.projections.AutoScaledWCSAxes.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">obstime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">naxis1</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS1&quot;</span><span class="p">]</span>
        <span class="n">naxis2</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS2&quot;</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">naxis1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">naxis2</span><span class="p">)</span>
        <span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">naxis1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
        <span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">naxis2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
        <span class="n">scale1</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">naxis1</span>
        <span class="n">scale2</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">naxis2</span>
        <span class="n">h</span><span class="p">[</span><span class="s2">&quot;CRPIX1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;CRPIX1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">naxis1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">h</span><span class="p">[</span><span class="s2">&quot;CRPIX2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;CRPIX2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">naxis2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">h</span><span class="p">[</span><span class="s2">&quot;CDELT1&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale1</span>
        <span class="n">h</span><span class="p">[</span><span class="s2">&quot;CDELT2&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale2</span>
        <span class="k">if</span> <span class="n">obstime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">h</span><span class="p">[</span><span class="s2">&quot;DATE-OBS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">obstime</span><span class="p">)</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">isot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_wcs</span><span class="p">(</span><span class="n">WCS</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;NAXIS2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">h</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span>

<div class="viewcode-block" id="AutoScaledWCSAxes.mark_inset_axes"><a class="viewcode-back" href="../../../../notebooks/api/gbmgeometry.utils.plotting.html#gbmgeometry.utils.plotting.projections.AutoScaledWCSAxes.mark_inset_axes">[docs]</a>    <span class="k">def</span> <span class="nf">mark_inset_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Outline the footprint of another WCSAxes inside this one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : `astropy.visualization.wcsaxes.WCSAxes`</span>
<span class="sd">            The other axes.</span>

<span class="sd">        Other parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        args :</span>
<span class="sd">            Extra arguments for `matplotlib.patches.PathPatch`</span>
<span class="sd">        kwargs :</span>
<span class="sd">            Extra keyword arguments for `matplotlib.patches.PathPatch`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        patch : `matplotlib.patches.PathPatch`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">WCSInsetPatch</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s2">&quot;world&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AutoScaledWCSAxes.connect_inset_axes"><a class="viewcode-back" href="../../../../notebooks/api/gbmgeometry.utils.plotting.html#gbmgeometry.utils.plotting.projections.AutoScaledWCSAxes.connect_inset_axes">[docs]</a>    <span class="k">def</span> <span class="nf">connect_inset_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect a corner of another WCSAxes to the matching point inside</span>
<span class="sd">        this one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : `astropy.visualization.wcsaxes.WCSAxes`</span>
<span class="sd">            The other axes.</span>
<span class="sd">        loc : int, str</span>
<span class="sd">            Which corner to connect. For valid values, see</span>
<span class="sd">            `matplotlib.offsetbox.AnchoredOffsetbox`.</span>

<span class="sd">        Other parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        args :</span>
<span class="sd">            Extra arguments for `matplotlib.patches.ConnectionPatch`</span>
<span class="sd">        kwargs :</span>
<span class="sd">            Extra keyword arguments for `matplotlib.patches.ConnectionPatch`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        patch : `matplotlib.patches.ConnectionPatch`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">WCSInsetConnectionPatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="AutoScaledWCSAxes.compass"><a class="viewcode-back" href="../../../../notebooks/api/gbmgeometry.utils.plotting.html#gbmgeometry.utils.plotting.projections.AutoScaledWCSAxes.compass">[docs]</a>    <span class="k">def</span> <span class="nf">compass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a compass to indicate the north and east directions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x, y : float</span>
<span class="sd">            Position of compass vertex in axes coordinates.</span>
<span class="sd">        size : float</span>
<span class="sd">            Size of compass in axes coordinates.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">pixel_scale_matrix</span>
        <span class="n">scale</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">scale</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="n">label</span><span class="p">,</span>
                <span class="n">xy</span><span class="p">,</span>
                <span class="n">xy</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;&lt;-&quot;</span><span class="p">,</span> <span class="n">shrinkA</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">shrinkB</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">ha</span><span class="p">,</span> <span class="n">va</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">scale</span><span class="p">,</span> <span class="s2">&quot;EN&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="AutoScaledWCSAxes.scalebar"><a class="viewcode-back" href="../../../../notebooks/api/gbmgeometry.utils.plotting.html#gbmgeometry.utils.plotting.projections.AutoScaledWCSAxes.scalebar">[docs]</a>    <span class="k">def</span> <span class="nf">scalebar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add scale bar.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xy : tuple</span>
<span class="sd">            The axes coordinates of the scale bar.</span>
<span class="sd">        length : `astropy.units.Quantity`</span>
<span class="sd">            The length of the scale bar in angle-compatible units.</span>

<span class="sd">        Other parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        args :</span>
<span class="sd">            Extra arguments for `matplotlib.patches.FancyArrowPatch`</span>
<span class="sd">        kwargs :</span>
<span class="sd">            Extra keyword arguments for `matplotlib.patches.FancyArrowPatch`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        patch : `matplotlib.patches.FancyArrowPatch`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ScaleBar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div></div>

    <span class="c1"># def _reproject_hpx(self, data, hdu_in=None, order=&#39;bilinear&#39;,</span>
    <span class="c1">#                    nested=False, field=0, smooth=None):</span>
    <span class="c1">#     if isinstance(data, np.ndarray):</span>
    <span class="c1">#         data = (data, self.header[&#39;RADESYS&#39;])</span>

    <span class="c1">#     # It&#39;s normal for reproject_from_healpix to produce some Numpy invalid</span>
    <span class="c1">#     # value warnings for points that land outside the projection.</span>
    <span class="c1">#     with np.errstate(invalid=&#39;ignore&#39;):</span>
    <span class="c1">#         img, mask = reproject_from_healpix(</span>
    <span class="c1">#             data, self.header, hdu_in=hdu_in, order=order, nested=nested,</span>
    <span class="c1">#             field=field)</span>
    <span class="c1">#     img = np.ma.array(img, mask=~mask.astype(bool))</span>

    <span class="c1">#     if smooth is not None:</span>
    <span class="c1">#         pixsize = np.mean(np.abs(self.wcs.wcs.cdelt)) * u.deg</span>
    <span class="c1">#         smooth = (smooth / pixsize).to(u.dimensionless_unscaled).value</span>
    <span class="c1">#         kernel = Gaussian2DKernel(smooth)</span>
    <span class="c1">#         # Ignore divide by zero warnings for pixels that have no valid</span>
    <span class="c1">#         # neighbors.</span>
    <span class="c1">#         with np.errstate(invalid=&#39;ignore&#39;):</span>
    <span class="c1">#             img = convolve_fft(img, kernel, fill_value=np.nan)</span>

    <span class="c1">#     return img</span>

    <span class="c1"># def contour_hpx(self, data, hdu_in=None, order=&#39;bilinear&#39;, nested=False,</span>
    <span class="c1">#                 field=0, smooth=None, **kwargs):</span>
    <span class="c1">#     &quot;&quot;&quot;Add contour levels for a HEALPix data set.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     data : `numpy.ndarray` or str or `~astropy.io.fits.TableHDU` or `~astropy.io.fits.BinTableHDU` or tuple</span>
    <span class="c1">#         The HEALPix data set. If this is a `numpy.ndarray`, then it is</span>
    <span class="c1">#         interpreted as the HEALPix array in the same coordinate system as</span>
    <span class="c1">#         the axes. Otherwise, the input data can be any type that is</span>
    <span class="c1">#         understood by `reproject.reproject_from_healpix`.</span>
    <span class="c1">#     smooth : `astropy.units.Quantity`, optional</span>
    <span class="c1">#         An optional smoothing length in angle-compatible units.</span>

    <span class="c1">#     Other parameters</span>
    <span class="c1">#     ----------------</span>
    <span class="c1">#     hdu_in, order, nested, field, smooth :</span>
    <span class="c1">#         Extra arguments for `reproject.reproject_from_healpix`</span>
    <span class="c1">#     kwargs :</span>
    <span class="c1">#         Extra keyword arguments for `matplotlib.axes.Axes.contour`</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     countours : `matplotlib.contour.QuadContourSet`</span>

    <span class="c1">#     &quot;&quot;&quot;  # noqa: E501</span>
    <span class="c1">#     img = self._reproject_hpx(data, hdu_in=hdu_in, order=order,</span>
    <span class="c1">#                               nested=nested, field=field, smooth=smooth)</span>
    <span class="c1">#     return self.contour(img, **kwargs)</span>

    <span class="c1"># def contourf_hpx(self, data, hdu_in=None, order=&#39;bilinear&#39;, nested=False,</span>
    <span class="c1">#                  field=0, smooth=None, **kwargs):</span>
    <span class="c1">#     &quot;&quot;&quot;Add filled contour levels for a HEALPix data set.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     data : `numpy.ndarray` or str or `~astropy.io.fits.TableHDU` or `~astropy.io.fits.BinTableHDU` or tuple</span>
    <span class="c1">#         The HEALPix data set. If this is a `numpy.ndarray`, then it is</span>
    <span class="c1">#         interpreted as the HEALPix array in the same coordinate system as</span>
    <span class="c1">#         the axes. Otherwise, the input data can be any type that is</span>
    <span class="c1">#         understood by `reproject.reproject_from_healpix`.</span>
    <span class="c1">#     smooth : `astropy.units.Quantity`, optional</span>
    <span class="c1">#         An optional smoothing length in angle-compatible units.</span>

    <span class="c1">#     Other parameters</span>
    <span class="c1">#     ----------------</span>
    <span class="c1">#     hdu_in, order, nested, field, smooth :</span>
    <span class="c1">#         Extra arguments for `reproject.reproject_from_healpix`</span>
    <span class="c1">#     kwargs :</span>
    <span class="c1">#         Extra keyword arguments for `matplotlib.axes.Axes.contour`</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     contours : `matplotlib.contour.QuadContourSet`</span>

    <span class="c1">#     &quot;&quot;&quot;  # noqa: E501</span>
    <span class="c1">#     img = self._reproject_hpx(data, hdu_in=hdu_in, order=order,</span>
    <span class="c1">#                               nested=nested, field=field, smooth=smooth)</span>
    <span class="c1">#     return self.contourf(img, **kwargs)</span>

    <span class="c1"># def imshow_hpx(self, data, hdu_in=None, order=&#39;bilinear&#39;, nested=False,</span>
    <span class="c1">#                field=0, smooth=None, **kwargs):</span>
    <span class="c1">#     &quot;&quot;&quot;Add an image for a HEALPix data set.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     data : `numpy.ndarray` or str or `~astropy.io.fits.TableHDU` or `~astropy.io.fits.BinTableHDU` or tuple</span>
    <span class="c1">#         The HEALPix data set. If this is a `numpy.ndarray`, then it is</span>
    <span class="c1">#         interpreted as the HEALPix array in the same coordinate system as</span>
    <span class="c1">#         the axes. Otherwise, the input data can be any type that is</span>
    <span class="c1">#         understood by `reproject.reproject_from_healpix`.</span>
    <span class="c1">#     smooth : `astropy.units.Quantity`, optional</span>
    <span class="c1">#         An optional smoothing length in angle-compatible units.</span>

    <span class="c1">#     Other parameters</span>
    <span class="c1">#     ----------------</span>
    <span class="c1">#     hdu_in, order, nested, field, smooth :</span>
    <span class="c1">#         Extra arguments for `reproject.reproject_from_healpix`</span>
    <span class="c1">#     kwargs :</span>
    <span class="c1">#         Extra keyword arguments for `matplotlib.axes.Axes.contour`</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     image : `matplotlib.image.AxesImage`</span>

    <span class="c1">#     &quot;&quot;&quot;  # noqa: E501</span>
    <span class="c1">#     img = self._reproject_hpx(data, hdu_in=hdu_in, order=order,</span>
    <span class="c1">#                               nested=nested, field=field, smooth=smooth)</span>
    <span class="c1">#     return self.imshow(img, **kwargs)</span>


<div class="viewcode-block" id="ScaleBar"><a class="viewcode-back" href="../../../../notebooks/api/gbmgeometry.utils.plotting.html#gbmgeometry.utils.plotting.projections.ScaleBar">[docs]</a><span class="k">class</span> <span class="nc">ScaleBar</span><span class="p">(</span><span class="n">FancyArrowPatch</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transAxesToWorld</span><span class="o">.</span><span class="n">transform</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">]])</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="o">*</span><span class="n">p1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="o">*</span><span class="n">p2</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">((</span><span class="n">p1</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="ScaleBar.__init__"><a class="viewcode-back" href="../../../../notebooks/api/gbmgeometry.utils.plotting.html#gbmgeometry.utils.plotting.projections.ScaleBar.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transAxesToWorld</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span>
        <span class="p">)</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">transform</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bounded&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
        <span class="n">custom_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">capstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_kwargs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">xy</span><span class="p">,</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="n">shrinkA</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">shrinkB</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ScaleBar.label"><a class="viewcode-back" href="../../../../notebooks/api/gbmgeometry.utils.plotting.html#gbmgeometry.utils.plotting.projections.ScaleBar.label">[docs]</a>    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot; </span><span class="si">{0.value:g}</span><span class="s2">{0.unit:unicode}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x1</span><span class="p">),</span>
            <span class="n">y</span><span class="p">,</span>
            <span class="n">s</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">Astro</span><span class="p">:</span>
    <span class="n">_crval1</span> <span class="o">=</span> <span class="mi">180</span>
    <span class="n">_xcoord</span> <span class="o">=</span> <span class="s2">&quot;RA--&quot;</span>
    <span class="n">_ycoord</span> <span class="o">=</span> <span class="s2">&quot;DEC-&quot;</span>
    <span class="n">_radesys</span> <span class="o">=</span> <span class="s2">&quot;ICRS&quot;</span>


<span class="k">class</span> <span class="nc">GeoAngleFormatterLocator</span><span class="p">(</span><span class="n">AngleFormatterLocator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">formatter</span><span class="p">(</span>
            <span class="n">reference_angle_deg</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">spacing</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">Geo</span><span class="p">:</span>
    <span class="n">_crval1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_radesys</span> <span class="o">=</span> <span class="s2">&quot;ITRS&quot;</span>
    <span class="n">_xcoord</span> <span class="o">=</span> <span class="s2">&quot;TLON&quot;</span>
    <span class="n">_ycoord</span> <span class="o">=</span> <span class="s2">&quot;TLAT&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_formatter_locator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_formatter_locator</span> <span class="o">=</span> <span class="n">GeoAngleFormatterLocator</span><span class="p">(</span>
            <span class="n">values</span><span class="o">=</span><span class="n">fl</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">number</span><span class="o">=</span><span class="n">fl</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
            <span class="n">spacing</span><span class="o">=</span><span class="n">fl</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">fl</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
            <span class="n">format_unit</span><span class="o">=</span><span class="n">fl</span><span class="o">.</span><span class="n">format_unit</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">Degrees</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;WCS axes with longitude axis in degrees.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_format_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Hours</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;WCS axes with longitude axis in hour angle.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_format_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Globe</span><span class="p">(</span><span class="n">AutoScaledWCSAxes</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s2">&quot;0d 0d&quot;</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">center</span><span class="p">)</span><span class="o">.</span><span class="n">icrs</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;NAXIS&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;NAXIS1&quot;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>
            <span class="s2">&quot;NAXIS2&quot;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>
            <span class="s2">&quot;CRPIX1&quot;</span><span class="p">:</span> <span class="mf">90.5</span><span class="p">,</span>
            <span class="s2">&quot;CRPIX2&quot;</span><span class="p">:</span> <span class="mf">90.5</span><span class="p">,</span>
            <span class="s2">&quot;CRVAL1&quot;</span><span class="p">:</span> <span class="n">center</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
            <span class="s2">&quot;CRVAL2&quot;</span><span class="p">:</span> <span class="n">center</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
            <span class="s2">&quot;CDELT1&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
            <span class="s2">&quot;CDELT2&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
            <span class="s2">&quot;CTYPE1&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xcoord</span> <span class="o">+</span> <span class="s2">&quot;-SIN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CTYPE2&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ycoord</span> <span class="o">+</span> <span class="s2">&quot;-SIN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RADESYS&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radesys</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">rotate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;LONPOLE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">rotate</span><span class="p">)</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">frame_class</span><span class="o">=</span><span class="n">EllipticalFrame</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Zoom</span><span class="p">(</span><span class="n">AutoScaledWCSAxes</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s2">&quot;0d 0d&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="s2">&quot;1 deg&quot;</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">center</span><span class="p">)</span><span class="o">.</span><span class="n">icrs</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;NAXIS&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;NAXIS1&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
            <span class="s2">&quot;NAXIS2&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
            <span class="s2">&quot;CRPIX1&quot;</span><span class="p">:</span> <span class="mf">256.5</span><span class="p">,</span>
            <span class="s2">&quot;CRPIX2&quot;</span><span class="p">:</span> <span class="mf">256.5</span><span class="p">,</span>
            <span class="s2">&quot;CRVAL1&quot;</span><span class="p">:</span> <span class="n">center</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
            <span class="s2">&quot;CRVAL2&quot;</span><span class="p">:</span> <span class="n">center</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
            <span class="s2">&quot;CDELT1&quot;</span><span class="p">:</span> <span class="o">-</span><span class="n">radius</span> <span class="o">/</span> <span class="mi">256</span><span class="p">,</span>
            <span class="s2">&quot;CDELT2&quot;</span><span class="p">:</span> <span class="n">radius</span> <span class="o">/</span> <span class="mi">256</span><span class="p">,</span>
            <span class="s2">&quot;CTYPE1&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xcoord</span> <span class="o">+</span> <span class="s2">&quot;-TAN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CTYPE2&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ycoord</span> <span class="o">+</span> <span class="s2">&quot;-TAN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RADESYS&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radesys</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">rotate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">header</span><span class="p">[</span><span class="s2">&quot;LONPOLE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">rotate</span><span class="p">)</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AllSkyAxes</span><span class="p">(</span><span class="n">AutoScaledWCSAxes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for a multi-purpose all-sky projection.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;NAXIS&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;NAXIS1&quot;</span><span class="p">:</span> <span class="mi">360</span><span class="p">,</span>
            <span class="s2">&quot;NAXIS2&quot;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>
            <span class="s2">&quot;CRPIX1&quot;</span><span class="p">:</span> <span class="mf">180.5</span><span class="p">,</span>
            <span class="s2">&quot;CRPIX2&quot;</span><span class="p">:</span> <span class="mf">90.5</span><span class="p">,</span>
            <span class="s2">&quot;CRVAL1&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crval1</span><span class="p">,</span>
            <span class="s2">&quot;CRVAL2&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;CDELT1&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
            <span class="s2">&quot;CDELT2&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
            <span class="s2">&quot;CTYPE1&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xcoord</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wcsprj</span><span class="p">,</span>
            <span class="s2">&quot;CTYPE2&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ycoord</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wcsprj</span><span class="p">,</span>
            <span class="s2">&quot;RADESYS&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radesys</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">frame_class</span><span class="o">=</span><span class="n">EllipticalFrame</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mi">45</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ticklabel</span><span class="p">(</span><span class="n">exclude_overlapping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ticklabel</span><span class="p">(</span><span class="n">exclude_overlapping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Aitoff</span><span class="p">(</span><span class="n">AllSkyAxes</span><span class="p">):</span>
    <span class="n">_wcsprj</span> <span class="o">=</span> <span class="s2">&quot;AIT&quot;</span>


<span class="k">class</span> <span class="nc">Mollweide</span><span class="p">(</span><span class="n">AllSkyAxes</span><span class="p">):</span>
    <span class="n">_wcsprj</span> <span class="o">=</span> <span class="s2">&quot;MOL&quot;</span>


<span class="n">moddict</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>

<span class="c1">#</span>
<span class="c1"># Create subclasses and register all projections:</span>
<span class="c1"># &#39;{astro|geo} {hours|degrees} {aitoff|globe|mollweide|zoom}&#39;</span>
<span class="c1">#</span>
<span class="n">bases1</span> <span class="o">=</span> <span class="p">(</span><span class="n">Astro</span><span class="p">,</span> <span class="n">Geo</span><span class="p">)</span>
<span class="n">bases2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Hours</span><span class="p">,</span> <span class="n">Degrees</span><span class="p">)</span>
<span class="n">bases3</span> <span class="o">=</span> <span class="p">(</span><span class="n">Aitoff</span><span class="p">,</span> <span class="n">Globe</span><span class="p">,</span> <span class="n">Mollweide</span><span class="p">,</span> <span class="n">Zoom</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bases</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">bases1</span><span class="p">,</span> <span class="n">bases2</span><span class="p">,</span> <span class="n">bases3</span><span class="p">):</span>
    <span class="n">class_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;Axes&quot;</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">)</span>
    <span class="n">new_class</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">projection</span><span class="p">})</span>
    <span class="n">projection_registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">new_class</span><span class="p">)</span>
    <span class="n">moddict</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_class</span>
    <span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># Create some synonyms:</span>
<span class="c1"># &#39;astro&#39; will be short for &#39;astro hours&#39;,</span>
<span class="c1"># &#39;geo&#39; will be short for &#39;geo degrees&#39;</span>
<span class="c1">#</span>
<span class="k">for</span> <span class="n">base1</span><span class="p">,</span> <span class="n">base2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bases1</span><span class="p">,</span> <span class="n">bases2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">base3</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Aitoff</span><span class="p">,</span> <span class="n">Globe</span><span class="p">,</span> <span class="n">Mollweide</span><span class="p">,</span> <span class="n">Zoom</span><span class="p">):</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">(</span><span class="n">base1</span><span class="p">,</span> <span class="n">base2</span><span class="p">,</span> <span class="n">base3</span><span class="p">)</span>
        <span class="n">orig_class_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;Axes&quot;</span>
        <span class="n">orig_class</span> <span class="o">=</span> <span class="n">moddict</span><span class="p">[</span><span class="n">orig_class_name</span><span class="p">]</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="p">(</span><span class="n">base1</span><span class="p">,</span> <span class="n">base3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;Axes&quot;</span>
        <span class="n">projection</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="p">(</span><span class="n">base1</span><span class="p">,</span> <span class="n">base3</span><span class="p">))</span>
        <span class="n">new_class</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="p">(</span><span class="n">orig_class</span><span class="p">,),</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">projection</span><span class="p">})</span>
        <span class="n">projection_registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">new_class</span><span class="p">)</span>
        <span class="n">moddict</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_class</span>
        <span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>

<span class="k">del</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">moddict</span><span class="p">,</span> <span class="n">projection</span><span class="p">,</span> <span class="n">projection_registry</span><span class="p">,</span> <span class="n">new_class</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">__all__</span><span class="p">)</span>
</pre></div>

           </div>
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, J. Michael Burgess.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>